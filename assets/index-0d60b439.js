import{r as e,u as I,f as $,M as b,b as A,P as O,i as U,L as S}from"./index-a526dbf9.js";function L(){const r=e.useRef(!1);return I(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function T(){const r=L(),[o,t]=e.useState(0),s=e.useCallback(()=>{r.current&&t(o+1)},[o]);return[e.useCallback(()=>$.postRender(s),[s]),o]}class B extends e.Component{getSnapshotBeforeUpdate(o){const t=this.props.childRef.current;if(t&&o.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function D({children:r,isPresent:o}){const t=e.useId(),s=e.useRef(null),p=e.useRef({width:0,height:0,top:0,left:0}),{nonce:l}=e.useContext(b);return e.useInsertionEffect(()=>{const{width:a,height:u,top:h,left:d}=p.current;if(o||!s.current||!a||!u)return;s.current.dataset.motionPopId=t;const n=document.createElement("style");return l&&(n.nonce=l),document.head.appendChild(n),n.sheet&&n.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${u}px !important;
            top: ${h}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(n)}},[o]),e.createElement(B,{isPresent:o,childRef:s,sizeRef:p},e.cloneElement(r,{ref:s}))}const P=({children:r,initial:o,isPresent:t,onExitComplete:s,custom:p,presenceAffectsLayout:l,mode:a})=>{const u=A(G),h=e.useId(),d=e.useMemo(()=>({id:h,initial:o,isPresent:t,custom:p,onExitComplete:n=>{u.set(n,!0);for(const i of u.values())if(!i)return;s&&s()},register:n=>(u.set(n,!1),()=>u.delete(n))}),l?void 0:[t]);return e.useMemo(()=>{u.forEach((n,i)=>u.set(i,!1))},[t]),e.useEffect(()=>{!t&&!u.size&&s&&s()},[t]),a==="popLayout"&&(r=e.createElement(D,{isPresent:t},r)),e.createElement(O.Provider,{value:d},r)};function G(){return new Map}function H(r){return e.useEffect(()=>()=>r(),[])}const m=r=>r.key||"";function V(r,o){r.forEach(t=>{const s=m(t);o.set(s,t)})}function W(r){const o=[];return e.Children.forEach(r,t=>{e.isValidElement(t)&&o.push(t)}),o}const j=({children:r,custom:o,initial:t=!0,onExitComplete:s,exitBeforeEnter:p,presenceAffectsLayout:l=!0,mode:a="sync"})=>{U(!p);const u=e.useContext(S).forceRender||T()[0],h=L(),d=W(r);let n=d;const i=e.useRef(new Map).current,x=e.useRef(n),C=e.useRef(new Map).current,y=e.useRef(!0);if(I(()=>{y.current=!1,V(d,C),x.current=n}),H(()=>{y.current=!0,C.clear(),i.clear()}),y.current)return e.createElement(e.Fragment,null,n.map(c=>e.createElement(P,{key:m(c),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:l,mode:a},c)));n=[...n];const g=x.current.map(m),M=d.map(m),v=g.length;for(let c=0;c<v;c++){const f=g[c];M.indexOf(f)===-1&&!i.has(f)&&i.set(f,void 0)}return a==="wait"&&i.size&&(n=[]),i.forEach((c,f)=>{if(M.indexOf(f)!==-1)return;const w=C.get(f);if(!w)return;const F=g.indexOf(f);let R=c;if(!R){const K=()=>{i.delete(f);const z=Array.from(C.keys()).filter(E=>!M.includes(E));if(z.forEach(E=>C.delete(E)),x.current=d.filter(E=>{const k=m(E);return k===f||z.includes(k)}),!i.size){if(h.current===!1)return;u(),s&&s()}};R=e.createElement(P,{key:m(w),isPresent:!1,onExitComplete:K,custom:o,presenceAffectsLayout:l,mode:a},w),i.set(f,R)}n.splice(F,0,R)}),n=n.map(c=>{const f=c.key;return i.has(f)?c:e.createElement(P,{key:m(c),isPresent:!0,presenceAffectsLayout:l,mode:a},c)}),e.createElement(e.Fragment,null,i.size?n:n.map(c=>e.cloneElement(c)))};export{j as A};
